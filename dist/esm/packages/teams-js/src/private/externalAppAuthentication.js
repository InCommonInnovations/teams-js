import{sendMessageToParentAsync as e}from"../internal/communication.js";import{ensureInitialized as t}from"../internal/internalAPIs.js";import{getApiVersionTag as n}from"../internal/telemetry.js";import{validateId as o,validateUrl as i}from"../internal/utils.js";import{FrameContexts as r,errorNotSupportedOnPlatform as s}from"../public/constants.js";import{runtime as a}from"../public/runtime.js";import{AppId as u}from"../public/appId.js";const c="v2";var h;!function(h){let p;var l;let f;function m(e){if(e.requestType===p.ActionExecuteInvokeRequest){const t=e;if(t.type!==h.ActionExecuteInvokeRequestType){throw{errorCode:f.INTERNAL_ERROR,message:`Invalid action type ${t.type}. Action type must be "${h.ActionExecuteInvokeRequestType}"`}}}else if(e.requestType===p.QueryMessageExtensionRequest){if(e.commandId.length>64)throw new Error("originalRequestInfo.commandId exceeds the maximum size of 64 characters");if(e.parameters.length>5)throw new Error("originalRequestInfo.parameters exceeds the maximum size of 5");for(const t of e.parameters){if(t.name.length>64)throw new Error("originalRequestInfo.parameters.name exceeds the maximum size of 64 characters");if(t.value.length>512)throw new Error("originalRequestInfo.parameters.value exceeds the maximum size of 512 characters")}}}function R(){return!(!t(a)||!a.supports.externalAppAuthentication)}h.isActionExecuteResponse=function(e){const t=e;return t.responseType===h.InvokeResponseType.ActionExecuteInvokeResponse&&void 0!==t.value&&void 0!==t.statusCode&&void 0!==t.type},h.ActionExecuteInvokeRequestType="Action.Execute",function(e){e.ActionExecuteInvokeRequest="ActionExecuteInvokeRequest",e.QueryMessageExtensionRequest="QueryMessageExtensionRequest"}(p=h.OriginalRequestType||(h.OriginalRequestType={})),(l=h.InvokeResponseType||(h.InvokeResponseType={})).ActionExecuteInvokeResponse="ActionExecuteInvokeResponse",l.QueryMessageExtensionResponse="QueryMessageExtensionResponse",h.isInvokeError=function(e){if("object"!=typeof e||null===e)return!1;const t=e;return Object.values(h.InvokeErrorCode).includes(t.errorCode)&&(void 0===t.message||"string"==typeof t.message)},function(e){e.INTERNAL_ERROR="INTERNAL_ERROR"}(f=h.InvokeErrorCode||(h.InvokeErrorCode={})),h.authenticateAndResendRequest=function(o,i,h){if(t(a,r.content),!R())throw s;const p=new u(o);return m(h),e(n(c,"externalAppAuthentication.authenticateAndResendRequest"),"externalAppAuthentication.authenticateAndResendRequest",[p.toString(),h,i.url.href,i.width,i.height,i.isExternal]).then((([e,t])=>{if(e&&null!=t.responseType)return t;throw t}))},h.authenticateWithSSO=function(o,i){if(t(a,r.content),!R())throw s;const h=new u(o);return e(n(c,"externalAppAuthentication.authenticateWithSSO"),"externalAppAuthentication.authenticateWithSSO",[h.toString(),i.claims,i.silent]).then((([e,t])=>{if(!e)throw t}))},h.authenticateWithSSOAndResendRequest=function(o,i,h){if(t(a,r.content),!R())throw s;const p=new u(o);return m(h),e(n(c,"externalAppAuthentication.authenticateWithSSOAndResendRequest"),"externalAppAuthentication.authenticateWithSSOAndResendRequest",[p.toString(),h,i.claims,i.silent]).then((([e,t])=>{if(e&&null!=t.responseType)return t;throw t}))},h.authenticateWithOauth2=function(i,u,h){if(t(a,r.content),!R())throw s;return o(i,new Error("titleId is Invalid.")),o(u,new Error("oauthConfigId is Invalid.")),e(n(c,"externalAppAuthentication.authenticateWithOauth2"),"externalAppAuthentication.authenticateWithOauth2",[i,u,h.width,h.height,h.isExternal]).then((([e,t])=>{if(!e)throw t}))},h.authenticateWithPowerPlatformConnectorPlugins=function(u,h,p){if(t(a,r.content),!R())throw s;return o(u,new Error("titleId is Invalid.")),h&&i(h),e(n(c,"externalAppAuthentication.authenticateWithPowerPlatformConnectorPlugins"),"externalAppAuthentication.authenticateWithPowerPlatformConnectorPlugins",[u,null==h?void 0:h.toString(),null==p?void 0:p.width,null==p?void 0:p.height,null==p?void 0:p.isExternal]).then((([e,t])=>{if(!e)throw t}))},h.isSupported=R}(h||(h={}));export{h as externalAppAuthentication};
